rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Regla general: Nadie puede leer o escribir por defecto.
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // Los sprites extraídos se guardan en la carpeta `sprites/{userId}/{spriteId}`
    match /sprites/{userId}/{spriteId} {
      
      // Lectura: Cualquier persona con la URL puede leer el sprite.
      // Esto es necesario para que las URLs públicas funcionen.
      allow read: if true;

      // Escritura (Crear, Actualizar, Borrar):
      // Solo el usuario autenticado que es dueño de esa "carpeta" puede subir archivos.
      // `request.auth.uid` es el ID del usuario que hace la petición.
      // `userId` es el comodín de la ruta.
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
